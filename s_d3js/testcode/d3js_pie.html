<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>D3JS:绘制饼图</title>
        <script type="text/javascript" src="../d3/d3.js"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- 引入 Bootstrap -->
        <link href="../../s_bootstrap/bootstrap/css/bootstrap.min.css" rel="stylesheet">
        <!-- HTML5 Shim 和 Respond.js 用于让IE8支持 HTML5 元素和媒体查询 -->
        <!-- 注意：如果通过 file:// 引入Respond.js文件，则该文件无效 -->
        <!-- [if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https//oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
            <![endif]
            -->
        <style>
            g.arc path:hover {
                fill:orange;
            }
        </style>
    </head>
    <body>
        <H1>d3.arc,绘制饼图</H1>
        <p>饼图实际是用弧线来绘制，先通过pie()方法生成绘制弧线的路径信息，再通过布局arc()方法绘制饼图。</p>
        <ol>
            <li>生成svg元素</li>
            <li>创建pie()饼图生成器，将数据集转换成弧线路径信息</li>
                <pre>
var pie = d3.pie(); // 创建饼图生成器
pie(dataset);   // 转换路径信息，包括startAngle,endAngle等
                </pre>
            <li>创建arc()弧线生成器，准备接收数据</li>
                <pre>
var arc = d3.arc()
            .innerRadius()  // 指定内圆半径，通常为0。可指定数值，绘制圆环图
            .outerRadius(); // 指定外圆半径
                </pre>
            <li>绘制图形</li>
                <pre>
.svg.append("path")
    .attr("fill","grey")    // 指定每个扇形的颜色
    .attr("d", arc);        // 绘制扇形
                </pre>
        </ol>
        <button type="button" class="btn">显示示例数据</button>
        <div class="example"></div>
        <script type="text/javascript">
           
            // 创建数据集
            var dataset = [5, 10, 20, 30];
            var sumValue = 0;
            for(var i = 0; i < dataset.length; i++){sumValue +=dataset[i]};
            // 创建扇形，使用分组g创建
            // 创建一个饼图生成器，用于把dataset数据转换成为饼图的数据，比如角度等。
            var pie = d3.pie();
            // 创建一个弧线路径生成器arc
            var outerRadius = 100;
            var innerRadius = 0;
            var arc = d3.arc()
                        .innerRadius(innerRadius)
                        .outerRadius(outerRadius);
            // 创建SVG元素
            var w = 300;
            var h = 300;
            var svg = d3.select("body div.example")
                        .append("svg")
                        .attr("width", w)
                        .attr("height", h);
            // 绘制图形
            var color = function(i){return d3.hsl(240, 1, 1 - i);};
            var arcs = svg.selectAll("g.arc")
                          .data(pie(dataset))
                          .enter()
                          .append("g")
                          .attr("class", "arc")
                          .attr("transform", "translate(" + w/2 + ", " + h/2 + ")");
            arcs.append("path")
                .attr("fill", function(d, i){return color(d.data / sumValue);})
                .attr("d", arc)
                .append("title")
                .text(function(d, i){return "this area is : " + d.data;})
                .on('click', function(d){
                    d3.select(this)
                });
            
        </script>
    </body>
</html>